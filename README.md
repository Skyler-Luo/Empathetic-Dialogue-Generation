# ğŸ¤– Empathetic-Dialogue-Generation (RAICOM2025)

âœ¨ æœ¬é¡¹ç›®ä¸º**ç¿æŠ— 2025 æ™ºæµ·äººå·¥æ™ºèƒ½ç®—æ³•åº”ç”¨èµ›å›½èµ›**å‚èµ›é¡¹ç›®ï¼Œè£è·**äºŒç­‰å¥–**ã€‚ğŸŒˆ

## é¡¹ç›®èƒŒæ™¯

éšç€äººå·¥æ™ºèƒ½æŠ€æœ¯çš„å‘å±•ï¼Œæ„å»ºèƒ½å¤Ÿè¿›è¡Œæµç•…ã€æœ‰é€»è¾‘ã€å¤šè½®å¯¹è¯çš„æ™ºèƒ½ç³»ç»Ÿæˆä¸ºäº†çƒ­é—¨æ–¹å‘ã€‚Transformer æ¶æ„ï¼Œå‡­å€Ÿå…¶å¼ºå¤§çš„è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œåœ¨åºåˆ—å»ºæ¨¡ä»»åŠ¡ä¸Šå–å¾—äº†çªç ´æ€§è¿›å±•ã€‚æœ¬é¡¹ç›®æ—¨åœ¨è®­ç»ƒä¸€ä¸ª**åŸºäº Transformer çš„å¯¹è¯ç”Ÿæˆæ¨¡å‹**ã€‚è¯¥æ¨¡å‹èƒ½å¤Ÿç†è§£ç”¨æˆ·æ„å›¾ï¼Œå¹¶ç”Ÿæˆè¿è´¯ã€ç›¸å…³çš„å›å¤ï¼Œæ¨¡æ‹ŸçœŸå®çš„å¯¹è¯åœºæ™¯ã€‚å­¦ç”Ÿå°†å­¦ä¹  **Transformer çš„æ ¸å¿ƒç»„ä»¶**ï¼ˆå¦‚è‡ªæ³¨æ„åŠ›ã€å¤šå¤´æ³¨æ„åŠ›ã€ä½ç½®ç¼–ç ï¼‰ï¼Œä»¥åŠå¦‚ä½•å°†å…¶åº”ç”¨äº**å¯¹è¯ç”Ÿæˆä»»åŠ¡**ï¼Œç†è§£å…¶åœ¨è§£å†³é•¿è·ç¦»ä¾èµ–å’Œå¹¶è¡Œè®¡ç®—æ–¹é¢çš„ä¼˜åŠ¿ã€‚

## ğŸŒŸ é¡¹ç›®äº®ç‚¹

* ğŸ­ **å¤šåˆ†è¾¨ç‡æƒ…æ„Ÿå»ºæ¨¡**ï¼šç»“åˆä¸åŒå±‚æ¬¡çš„æƒ…æ„Ÿä¿¡æ¯ï¼Œæå‡å›å¤çš„å…±æƒ…èƒ½åŠ›
* âš”ï¸ **äº¤äº’å¼å¯¹æŠ—è®­ç»ƒ**ï¼šå¼•å…¥åŒåˆ¤åˆ«å™¨ï¼Œæå‡ç”Ÿæˆå¯¹è¯çš„çœŸå®æ€§ä¸å¤šæ ·æ€§
* ğŸ”¥ **Transformer æ¶æ„**ï¼šåŸºäºæ³¨æ„åŠ›æœºåˆ¶çš„å¼ºå¤§å¯¹è¯å»ºæ¨¡èƒ½åŠ›
* ğŸ’¬ **æƒ…æ„Ÿå¼•å¯¼ç”Ÿæˆ**ï¼šä¸ä»…ç†è§£è¯­ä¹‰ï¼Œè¿˜èƒ½ç”Ÿæˆå¸¦æœ‰æƒ…æ„Ÿè‰²å½©çš„å›å¤

## ğŸ“¦ ç¯å¢ƒä¾èµ–

* Python 3.8+
* PyTorchï¼ˆéœ€åŒ¹é…æœ¬åœ° CUDA ç‰ˆæœ¬ï¼‰
* å…¶ä»–ä¾èµ–è§ `requirements.txt`

### å®‰è£…æ­¥éª¤

```bash
# 1. åˆ›å»º Conda è™šæ‹Ÿç¯å¢ƒ (æ¨è)
conda create -n empdg python=3.8 -y

# 2. æ¿€æ´»ç¯å¢ƒ
conda activate empdg

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. æ£€æŸ¥ GPU æ˜¯å¦å¯ç”¨
python utils/check_torch_gpu.py
```

## ğŸ“‚ æ•°æ®é›†è¯´æ˜

æœ¬é¡¹ç›®ä½¿ç”¨ **EmpatheticDialogues** æ•°æ®é›†ï¼Œç‰¹ç‚¹ï¼š

* ğŸ—£ï¸ **å¯¹è¯ä¸Šä¸‹æ–‡**ï¼šæ¨¡æ‹ŸçœŸå®åœºæ™¯ä¸­çš„å¤šè½®å¯¹è¯
* ğŸ­ **æƒ…æ„Ÿæ ‡ç­¾**ï¼šè¦†ç›–å¤šç§æƒ…ç»ªï¼ˆå¼€å¿ƒã€ä¼¤å¿ƒã€æƒŠè®¶ç­‰ï¼‰
* ğŸ“– **æƒ…å¢ƒæè¿°**ï¼šæ¯æ®µå¯¹è¯å‡æœ‰å¯¹åº”çš„èƒŒæ™¯è¯´æ˜
* ğŸ’¡ **ç›®æ ‡å›å¤**ï¼šç”±äººå·¥æ’°å†™çš„æƒ…æ„ŸåŒ–å›å¤

> é¢„å¤„ç†åçš„æ•°æ®å·²å­˜æ”¾åœ¨ `datasets/empathetic-dialogue/`

## ğŸ—ï¸ æ¨¡å‹æ¶æ„

æœ¬é¡¹ç›®åŒ…å«ä¸€ä¸ªåŸºå‡†æ¨¡å‹ `EmoPrepend` å’Œä¸€ä¸ªæ ¸å¿ƒå¯¹æŠ—æ¨¡å‹ `EmpDG`ã€‚

### ğŸ”¹ åŸºç¡€æ¨¡å‹ (EmoPrepend)

`EmoPrepend` æ˜¯ä¸€ä¸ªåŸºäº Transformer çš„å¢å¼ºæ¨¡å‹ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯â€œæƒ…æ„Ÿå¼•å¯¼â€ï¼š
*   **æƒ…æ„Ÿå‰ç½®**ï¼šåˆ©ç”¨å¤–éƒ¨æƒ…æ„Ÿè¯å…¸ `NRCDict.json`ï¼Œåœ¨è¾“å…¥ç«¯ä¸ºä¸Šä¸‹æ–‡ä¸­çš„æƒ…æ„Ÿè¯æ³¨å…¥å¯å­¦ä¹ çš„â€œæƒ…æ„Ÿæç¤ºåµŒå…¥â€ï¼Œå¼•å¯¼ç¼–ç å™¨å…³æ³¨æƒ…æ„Ÿä¿¡å·ã€‚
*   **æƒ…æ„Ÿåˆ†ç±»å¤´**ï¼šåœ¨ç¼–ç å™¨ä¹‹ä¸Šå¢åŠ ä¸€ä¸ªåˆ†ç±»å¤´ï¼Œç”¨äºé¢„æµ‹å¯¹è¯çš„æ•´ä½“æƒ…æ„Ÿç±»åˆ«ï¼Œå¹¶é€šè¿‡å¤šä»»åŠ¡å­¦ä¹ å¢å¼ºæ¨¡å‹çš„æƒ…æ„Ÿæ„ŸçŸ¥èƒ½åŠ›ã€‚
*   **æŒ‡é’ˆç”Ÿæˆç½‘ç»œ**ï¼šå…è®¸æ¨¡å‹åœ¨ç”Ÿæˆå›å¤æ—¶ï¼Œä»åŸå§‹å¯¹è¯ä¸Šä¸‹æ–‡ä¸­ç›´æ¥å¤åˆ¶è¯è¯­ï¼Œæœ‰æ•ˆå¤„ç†æœªç™»å½•è¯ï¼ˆOOVï¼‰å’Œä¸“æœ‰åè¯ã€‚

### ğŸ”¹ æ ¸å¿ƒå¯¹æŠ—æ¨¡å‹ (EmpDG)

`EmpDG` (Empathetic Dialogue Generation) æ˜¯ä¸€ä¸ªé‡‡ç”¨**äº¤äº’å¼å¯¹æŠ—è®­ç»ƒ**çš„å…±æƒ…å¯¹è¯ç”Ÿæˆæ¨¡å‹ï¼Œå»ºç«‹åœ¨ WGAN-GP æ¡†æ¶ä¹‹ä¸Šï¼Œç”±ä¸€ä¸ªç”Ÿæˆå™¨ï¼ˆGeneratorï¼‰å’Œä¸¤ä¸ªåˆ¤åˆ«å™¨ï¼ˆDiscriminatorï¼‰ç»„æˆã€‚

*   **ç”Ÿæˆå™¨ (EmpDG_G)**
    *   **å¤šåˆ†è¾¨ç‡æƒ…æ„Ÿå»ºæ¨¡**ï¼šé‡‡ç”¨åŒç¼–ç å™¨ç»“æ„ï¼Œä¸€ä¸ªç”¨äºç†è§£**è¯­ä¹‰ä¸Šä¸‹æ–‡**ï¼Œå¦ä¸€ä¸ªä¸“é—¨ç”¨äºæ„ŸçŸ¥**å¤šåˆ†è¾¨ç‡æƒ…æ„Ÿä¿¡æ¯**ï¼ˆå¯¹è¯çº§æƒ…æ„Ÿæ ‡ç­¾ + è¯è¯­çº§æƒ…æ„Ÿè¯ï¼‰ã€‚
    *   **æƒ…æ„Ÿæ¡ä»¶è§£ç **ï¼šå°†ç¼–ç å™¨é¢„æµ‹çš„æƒ…æ„Ÿç±»åˆ«å‘é‡ä½œä¸ºè§£ç å™¨çš„åˆå§‹è¾“å…¥ï¼Œå¼•å¯¼è§£ç å™¨ç”Ÿæˆä¸æƒ…æ„Ÿä¸€è‡´çš„å›å¤ã€‚

*   **äº¤äº’å¼åˆ¤åˆ«å™¨ (EmpDG_D)**
    *   **åŒåˆ¤åˆ«å™¨æ¶æ„**ï¼šåŒ…å«ä¸€ä¸ª**è¯­ä¹‰åˆ¤åˆ«å™¨**å’Œä¸€ä¸ª**æƒ…æ„Ÿåˆ¤åˆ«å™¨**ã€‚
        *   è¯­ä¹‰åˆ¤åˆ«å™¨ï¼šè¯„ä¼°å›å¤åœ¨å†…å®¹ä¸Šæ˜¯å¦è¿è´¯ã€åˆç†ã€‚
        *   æƒ…æ„Ÿåˆ¤åˆ«å™¨ï¼šè¯„ä¼°å›å¤åœ¨æƒ…æ„Ÿä¸Šæ˜¯å¦ä¸ä¸Šä¸‹æ–‡åŒ¹é…ã€‚
    *   **åˆ©ç”¨ç”¨æˆ·åé¦ˆ**ï¼šåˆ¤åˆ«å™¨ä¸ä»…åŒºåˆ†çœŸå®/ç”Ÿæˆå›å¤ï¼Œè¿˜åˆ›æ–°æ€§åœ°å¼•å…¥å¯¹è¯çš„**ä¸‹ä¸€è½®ç”¨æˆ·å›å¤**ä½œä¸ºéšå¼åé¦ˆä¿¡å·ï¼Œä»è€Œæ›´ç²¾å‡†åœ°æŒ‡å¯¼ç”Ÿæˆå™¨ä¼˜åŒ–ã€‚


## ğŸš€ æ¨¡å‹è®­ç»ƒ

é¡¹ç›®æä¾›äº†å¯¹å¤šä¸ªæ¨¡å‹çš„è®­ç»ƒæ”¯æŒï¼Œä¸»è¦åˆ†ä¸ºåŸºç¡€æ¨¡å‹è®­ç»ƒå’Œå¯¹æŠ—æ¨¡å‹è®­ç»ƒã€‚æ‰€æœ‰è®­ç»ƒå‚æ•°çš„é»˜è®¤å€¼å¯ä»¥åœ¨ `utils/config.py` ä¸­æŸ¥çœ‹å’Œä¿®æ”¹ã€‚

### ğŸ”¹ åŸºç¡€æ¨¡å‹è®­ç»ƒ

ä½¿ç”¨ `train.py` è„šæœ¬è®­ç»ƒ `Transformer`ã€`EmoPrepend` ç­‰åŸºç¡€æ¨¡å‹ã€‚

- **è®­ç»ƒ EmoPrepend æ¨¡å‹** (æ¨èçš„åŸºç¡€æ¨¡å‹):
  ```bash
  python train.py --cuda --model EmoPrepend --pretrain_emb --pointer_gen
  ```
- **è®­ç»ƒ Transformer åŸºç¡€æ¨¡å‹**:
  ```bash
  python train.py --cuda --model Transformer --pretrain_emb --pointer_gen
  ```
- **è®­ç»ƒ EmpDG_woD æ¨¡å‹** (ä»…ç”Ÿæˆå™¨éƒ¨åˆ†):
  ```bash
  python train.py --cuda --model EmpDG_woD --pretrain_emb --pointer_gen
  ```

### ğŸ”¹ å¯¹æŠ—è®­ç»ƒ (EmpDG)

ä½¿ç”¨ `adver_train.py` è„šæœ¬å¯¹ `EmpDG` æ¨¡å‹è¿›è¡Œä¸‰é˜¶æ®µçš„å¯¹æŠ—è®­ç»ƒï¼š

1.  **é¢„è®­ç»ƒç”Ÿæˆå™¨**ï¼šé¦–å…ˆè®­ç»ƒä¸€ä¸ªåŸºç¡€çš„å…±æƒ…ç”Ÿæˆå™¨ã€‚
2.  **é¢„è®­ç»ƒåˆ¤åˆ«å™¨**ï¼šå›ºå®šç”Ÿæˆå™¨ï¼Œè®­ç»ƒè¯­ä¹‰å’Œæƒ…æ„Ÿåˆ¤åˆ«å™¨ã€‚
3.  **è”åˆå¯¹æŠ—è®­ç»ƒ**ï¼šç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨äº¤æ›¿è®­ç»ƒï¼Œè¿›è¡Œåšå¼ˆä¼˜åŒ–ã€‚

- **è¿è¡Œå®Œæ•´çš„ EmpDG å¯¹æŠ—è®­ç»ƒ**:
  ```bash
  python adver_train.py --cuda --model EmpDG --emotion_disc --pretrain_emb --pointer_gen
  ```
- **ä»æ–­ç‚¹æ¢å¤å¯¹æŠ—è®­ç»ƒ**:
  ```bash
  python adver_train.py --cuda --model EmpDG --emotion_disc --pretrain_emb --pointer_gen --resume_g --resume_d
  ```

è®­ç»ƒæ—¥å¿—ä¸å¯è§†åŒ–ç»“æœå°†ä¿å­˜åˆ° `results/`ï¼Œæ¨¡å‹æƒé‡å­˜æ”¾åœ¨ `result/`ã€‚

## ğŸ“Š æ¨¡å‹è¯„ä¼°

æˆ‘ä»¬é‡‡ç”¨ä»¥ä¸‹è‡ªåŠ¨åŒ–æŒ‡æ ‡æ¥ç»¼åˆè¯„ä¼°æ¨¡å‹æ€§èƒ½ï¼š

*   **Perplexity (PPL)**ï¼šå›°æƒ‘åº¦ï¼Œè¡¡é‡æ¨¡å‹ç”Ÿæˆå›å¤çš„æµç•…æ€§ä»¥åŠå¯¹çœŸå®æ•°æ®åˆ†å¸ƒçš„æ‹Ÿåˆç¨‹åº¦ã€‚PPL è¶Šä½é€šå¸¸è¡¨ç¤ºæµç•…æ€§è¶Šå¥½ã€‚
*   **Distinct-1 / Distinct-2**ï¼šè¡¡é‡ç”Ÿæˆå›å¤çš„å¤šæ ·æ€§ï¼Œåˆ†åˆ«è®¡ç®—ä¸é‡å¤çš„ä¸€å…ƒæ–‡æ³•ï¼ˆunigramsï¼‰å’ŒäºŒå…ƒæ–‡æ³•ï¼ˆbigramsï¼‰çš„æ¯”ä¾‹ã€‚è¯¥æŒ‡æ ‡è¶Šé«˜ï¼Œè¡¨ç¤ºæ¨¡å‹ç”Ÿæˆçš„å›å¤è¶Šä¸å®¹æ˜“å‡ºç°é‡å¤å’Œé€šç”¨çš„å¥—è¯ã€‚
*   **Emotion Accuracy**ï¼šæƒ…æ„Ÿå‡†ç¡®ç‡ï¼Œè¡¡é‡ç”Ÿæˆå™¨å†…éƒ¨çš„æƒ…æ„Ÿåˆ†ç±»å™¨ä»å¯¹è¯ä¸Šä¸‹æ–‡ä¸­è¯†åˆ«æ­£ç¡®æƒ…æ„Ÿç±»åˆ«çš„èƒ½åŠ›ã€‚è¿™æ˜¯æ¨¡å‹èƒ½å¦äº§ç”Ÿå…±æƒ…å›å¤çš„å…³é”®å‰æã€‚

> æ³¨ï¼šæœ¬é¡¹ç›®ä¸ä½¿ç”¨ BLEUï¼Œå› å…¶ä¸å¯¹è¯è´¨é‡çš„ç›¸å…³æ€§è¾ƒå¼±ã€‚æ‰€æœ‰ç”Ÿæˆç¤ºä¾‹ä¸é¢„æµ‹ç»“æœå­˜æ”¾åœ¨ `Predictions/` ç›®å½•ä¸‹ã€‚

## ğŸ§ª æ¨¡å‹æµ‹è¯•ä¸å¯¹è¯

### ğŸ”¹ æ¨¡å‹æµ‹è¯•

æ‚¨å¯ä»¥ä½¿ç”¨ `train.py` è„šæœ¬åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œå¹¶åœ¨æµ‹è¯•é›†ä¸Šè¿›è¡Œè¯„ä¼°ã€‚è¯·ç¡®ä¿å¯¹åº”çš„æ¨¡å‹æƒé‡æ–‡ä»¶ï¼ˆå¦‚ `result/EmpDG_best.tar`ï¼‰å­˜åœ¨ã€‚

```bash
# åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼° EmpDG æ¨¡å‹
python train.py --test --model EmpDG --cuda --label_smoothing --noam --emb_dim 300 --hidden_dim 300 --hop 1 --heads 2 --pretrain_emb --pointer_gen
```

### ğŸ”¹ äº¤äº’å¼å¯¹è¯

é€šè¿‡ `interact.py` è„šæœ¬ï¼Œæ‚¨å¯ä»¥ä¸è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œå®æ—¶å¤šè½®å¯¹è¯ã€‚

```bash
# ä¸ EmpDG æ¨¡å‹è¿›è¡Œå¯¹è¯
python interact.py --model EmpDG --cuda --label_smoothing --noam --emb_dim 300 --hidden_dim 300 --hop 1 --heads 2 --pretrain_emb --pointer_gen
```

> **æ³¨æ„**ï¼šåœ¨æµ‹è¯•æˆ–äº¤äº’æ—¶ï¼Œè¯·ç¡®ä¿æ‰€ä½¿ç”¨çš„æ¨¡å‹è¶…å‚æ•°ï¼ˆå¦‚ `emb_dim`, `hidden_dim` ç­‰ï¼‰ä¸è®­ç»ƒæ—¶ä¿æŒä¸€è‡´ã€‚

### ğŸ”¹ ç”Ÿæˆç¤ºä¾‹

ä»¥ä¸‹æ˜¯ä¸€äº›åœ¨äº¤äº’ç¯å¢ƒä¸­ä¸ `EmpDG` æ¨¡å‹å¯¹è¯çš„ç¤ºä¾‹ï¼š

**ç¤ºä¾‹ 1ï¼š**

| è§’è‰²  | å›å¤                                                                |
| :---- | :------------------------------------------------------------------ |
| User  | i am so excited because i am finally going to visit my old friend ! |
| EmpDG | that is awesome ! what kind of visit ?                              |
| User  | we will enjoy chatting and playing .                                |
| EmpDG | that is a lot of nostalgia .                                        |

**ç¤ºä¾‹ 2ï¼š**

| è§’è‰²  | å›å¤                                    |
| :---- | :-------------------------------------- |
| User  | i argued with my brother .              |
| EmpDG | oh no ! what happened ?                 |
| User  | i don't want to recall .                |
| EmpDG | i am sorry , that is not a good thing . |

## ğŸ“ é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ Model/              # æ¨¡å‹å®ç° (EmpDG_G, EmpDG_D, Transformer)
â”œâ”€â”€ datasets/           # æ•°æ®é›†ä¸é¢„å¤„ç†æ–‡ä»¶
â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•° (æ•°æ®åŠ è½½ã€é…ç½®ç­‰)
â”œâ”€â”€ vectors/            # é¢„è®­ç»ƒ GloVe è¯å‘é‡
â”œâ”€â”€ results/            # TensorBoard æ—¥å¿—ä¸å¯è§†åŒ–
â”œâ”€â”€ result/             # è®­ç»ƒå¥½çš„æ¨¡å‹æƒé‡
â”œâ”€â”€ Predictions/        # æ¨¡å‹ç”Ÿæˆç»“æœä¸è¯„ä¼°
â”œâ”€â”€ *.ipynb             # Jupyter æ•™ç¨‹ç¬”è®°æœ¬
â”œâ”€â”€ train.py            # åŸºç¡€æ¨¡å‹è®­ç»ƒè„šæœ¬
â”œâ”€â”€ adver_train.py      # å¯¹æŠ—è®­ç»ƒè„šæœ¬
â””â”€â”€ interact.py         # äº¤äº’å¼å¯¹è¯è„šæœ¬
```

## ğŸ“’ æ•™ç¨‹ç¬”è®°æœ¬

0. `00ã€å®è®­é¡¹ç›®æ•™æ¡ˆ.ipynb`
1. `01ã€é¡¹ç›®ä»‹ç»ä¸æ•°æ®é›†åˆ†æå¤„ç†.ipynb`
2. `02ã€é¢„å¤‡çŸ¥è¯†ç‚¹å­¦ä¹ .ipynb`
3. `03ã€åŸºç¡€å¯¹è¯æ¨¡å‹æ­å»º.ipynb`
4. `04ã€è¿›é˜¶çŸ¥è¯†ä¸å¯¹æŠ—æ¨¡å‹å®ç°.ipynb`
5. `05ã€æ¨¡å‹è®­ç»ƒä¸è¯„ä¼°.ipynb`
6. `06ã€è°ƒç”¨æ¨¡å‹è¿›è¡Œå¯¹è¯.ipynb`

## ğŸ“š å‚è€ƒä»“åº“

* [Transformers](https://github.com/huggingface/transformers)
* [EmpatheticDialogues](https://github.com/facebookresearch/EmpatheticDialogues)
* [MoEL: Mixture of Empathetic Listeners](https://github.com/HLTCHKUST/MoEL)
* [EmpDG: Multi-resolution Interactive Empathetic Dialogue Generation](https://github.com/qtli/EmpDG)
* [learn-nlp-with-transformer](https://github.com/datawhalechina/learn-nlp-with-transformers)

---

âœ¨ **æœ¬é¡¹ç›®æ‰€æœ‰å†…å®¹ä»…ä¾›å­¦ä¹ æ‰€éœ€ï¼Œå¦‚æ‚¨æœ‰ä»»ä½•ä»»ä½•é—®é¢˜ï¼Œè¯·åŠæ—¶è”ç³»æˆ‘ï¼æ¬¢è¿ä¸€èµ·äº¤æµå­¦ä¹ ï¼** ğŸŒˆ
